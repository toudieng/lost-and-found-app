{% extends "frontend/policier/base_policier.html" %}

{% block title %}Objets Retrouv√©s en Attente{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="fw-bold mb-4 text-primary">üì¶ Objets retrouv√©s (en attente)</h2>

    <div class="row">
        {% for restitution in restitutions %}
            <div class="col-md-6 mb-3">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-body">
                        <!-- Nom de l'objet -->
                        <h5 class="card-title fw-bold text-dark">
                            {{ restitution.objet.nom }}
                            <span class="badge bg-warning text-dark">En attente</span>
                        </h5>

                        <!-- D√©clar√© par -->
                        <p class="mb-1 text-muted">
                            üôã <strong>D√©clar√© par :</strong> 
                            {% if restitution.citoyen %}
                                {{ restitution.citoyen.username }}
                                {% if restitution.citoyen.email %} ({{ restitution.citoyen.email }}){% endif %}
                            {% else %}
                                Non pr√©cis√©
                            {% endif %}
                        </p>

                        <!-- Commissariat -->
                        <p class="mb-2 text-muted">
                            üìç <strong>Commissariat :</strong> 
                            {% if restitution.commissariat %}
                                {{ restitution.commissariat.nom }}
                            {% else %}
                                Non pr√©cis√©
                            {% endif %}
                        </p>

                        <!-- Utilisateurs qui ont trouv√© -->
                        {% for declaration in restitution.objet.declarations_trouvees %}
                            {% if declaration.trouve_par.exists %}
                                <span class="badge bg-info mb-1 d-block">
                                    üìå Trouv√© par: 
                                    {% for user in declaration.trouve_par.all %}
                                        {{ user.username }}
                                        {% if user.email %} ({{ user.email }}){% endif %}
                                        {% if not forloop.last %}, {% endif %}
                                    {% endfor %}
                                </span>
                            {% endif %}
                        {% endfor %}
                    </div>

                    <!-- Boutons action -->
                    <div class="card-footer bg-light text-end">
                        <!-- Marquer restitu√© -->
                        <form method="POST" action="{% url 'marquer_restitue' restitution.id %}" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-success">
                                ‚úÖ Marquer restitu√©
                            </button>
                        </form>

                        <!-- Annuler restitution -->
                        <form method="POST" action="{% url 'annuler_restitution' restitution.id %}" class="d-inline ms-2">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-danger">
                                ‚ùå Annuler restitution
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="col-12">
                <div class="alert alert-info text-center">
                    Aucun objet retrouv√© en attente de restitution.
                </div>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
