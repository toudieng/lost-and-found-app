{% extends "frontend/admin/base_admin.html" %}
{% load static %}

{% block title %}Statistiques{% endblock %}

{% block extra_css %}
<style>
.container {
    max-width: 950px;
    margin: 2rem auto;
    padding: 1rem;
}

h2 {
    color: var(--main-color);
    font-weight: 700;
    margin-bottom: 2rem;
    text-align: center;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.stats-card {
    border-radius: 1rem;
    padding: 1.5rem;
    background-color: var(--light-color);
    box-shadow: 0 6px 15px rgba(0,0,0,0.08);
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.stats-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}

.stats-icon {
    font-size: 3rem;
    margin-bottom: 0.5rem;
    color: var(--main-color);
}

.stats-card h5 {
    margin: 0;
    font-size: 2rem;
    font-weight: 700;
    color: var(--main-color);
}

.stats-card small {
    color: #6c757d;
    font-size: 0.9rem;
}

canvas {
    margin-top: 0.5rem;
    width: 100% !important;
    height: 50px !important;
}

@media (max-width: 600px) {
    .stats-card {
        flex-direction: column;
        text-align: center;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h2>üìä Statistiques du syst√®me</h2>

    <div class="stats-grid">
        {% comment %} Objets g√©r√©s {% endcomment %}
        <div class="stats-card">
            <span class="stats-icon">üì¶</span>
            <h5>{{ nb_objets }}</h5>
            <small>Objets g√©r√©s</small>
            <canvas id="chartObjets"></canvas>
        </div>

        {% comment %} Restitutions {% endcomment %}
        <div class="stats-card">
            <span class="stats-icon">‚úÖ</span>
            <h5>{{ nb_restitutions }}</h5>
            <small>Restitutions</small>
            <canvas id="chartRestitutions"></canvas>
        </div>

        {% comment %} Citoyens {% endcomment %}
        <div class="stats-card">
            <span class="stats-icon">üßç</span>
            <h5>{{ nb_citoyens }}</h5>
            <small>Citoyens enregistr√©s</small>
            <canvas id="chartCitoyens"></canvas>
        </div>

        {% comment %} Policiers {% endcomment %}
        <div class="stats-card">
            <span class="stats-icon">üëÆ</span>
            <h5>{{ nb_policiers }}</h5>
            <small>Policiers actifs</small>
            <canvas id="chartPoliciers"></canvas>
        </div>

        {% comment %} Admins actifs {% endcomment %}
        <div class="stats-card">
            <span class="stats-icon">üõ°Ô∏è</span>
            <h5>{{ nb_admins }}</h5>
            <small>Admins actifs</small>
            <canvas id="chartAdmins"></canvas>
        </div>

        {% comment %} Objets d√©clar√©s {% endcomment %}
        <div class="stats-card">
            <span class="stats-icon">üìå</span>
            <h5>{{ nb_objets_declare }}</h5>
            <small>Objets d√©clar√©s</small>
            <canvas id="chartObjetsDeclare"></canvas>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function createSparkline(chartId, data, color) {
    const ctx = document.getElementById(chartId).getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.map((_, i) => i + 1),
            datasets: [{
                data: data,
                borderColor: color,
                backgroundColor: color + '33',
                tension: 0.3,
                fill: true,
                pointRadius: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { x: { display: false }, y: { display: false } }
        }
    });
}

// Utiliser les couleurs personnalis√©es
createSparkline('chartObjets', [5, 10, 8, 12, 15, 18, 20], 'var(--main-color)');
createSparkline('chartRestitutions', [2, 5, 4, 7, 6, 8, 10], 'var(--accent-color)');
createSparkline('chartCitoyens', [1, 3, 5, 7, 8, 10, 12], 'var(--main-color)');
createSparkline('chartPoliciers', [1, 2, 2, 3, 4, 5, 6], 'var(--accent-color-dark)');
createSparkline('chartAdmins', [1, 1, 2, 2, 3, 4, 4], 'var(--accent-color)');
createSparkline('chartObjetsDeclare', [3, 6, 8, 10, 12, 15, 18], 'var(--main-color-light)');
</script>
{% endblock %}
