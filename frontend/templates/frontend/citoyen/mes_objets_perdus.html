{% extends "frontend/citoyen/base_citoyen.html" %}
{% load static %}

{% block title %}Mes Objets Perdus{% endblock %}

{% block extra_css %}
<style>
/* Cartes des objets perdus */
.objet-perdu-card {
    border-radius: 1rem;
    background: #fff;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
    overflow: hidden;
}
.objet-perdu-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.15);
}

.objet-perdu-img { width: 100%; height: 200px; object-fit: cover; }
.objet-perdu-body { padding: 1rem 1.2rem; }
.objet-perdu-body h5 { color: #dc3545; font-weight: 700; font-size: 1.2rem; margin-bottom: 0.5rem; }
.objet-perdu-body p { font-size: 0.95rem; color: #555; margin-bottom: 0.35rem; }

.badge-etat { padding: 0.4em 0.65em; border-radius: 0.5rem; font-size: 0.8rem; font-weight: 600; color: #fff; }
.badge-perdu { background-color: #dc3545; }
.badge-reclame { background-color: #ffc107; color: #343a40; }
.badge-restitue { background-color: #17a2b8; }
.badge-en_attente { background-color: #6c757d; }

.objet-meta { font-size: 0.85rem; color: #6c757d; display: flex; justify-content: space-between; align-items: center; }

.btn-action { display: inline-block; padding: 0.4rem 0.8rem; border-radius: 0.5rem; font-size: 0.85rem; color: #fff; text-decoration: none; margin-right: 0.4rem; transition: background 0.3s; }
.btn-action-edit { background-color: #dc3545; } .btn-action-edit:hover { background-color: #b02a37; }
.btn-action-delete { background-color: #6c1e3d; } .btn-action-delete:hover { background-color: #8a2c55; }

@media (max-width: 768px) { .objet-perdu-img { height: 180px; } }
</style>
{% endblock %}

{% block content %}
<h2 class="welcome-title" style="color:#343a40;">üîç Mes objets perdus</h2>
<p class="text-muted">Tous les objets que vous avez d√©clar√©s comme perdus.</p>

<!-- Barre de recherche -->
<form method="get" class="search-bar mb-3">
    <input type="text" name="q" placeholder="Rechercher un objet..." value="{{ request.GET.q|default:'' }}">
</form>

{% if objets %}
    <div class="row g-4">
        {% for declaration in objets %}
            {% with objet=declaration.objet %}
            <div class="col-md-4">
                <div class="objet-perdu-card">
                    {% if objet.image %}
                        <img src="{{ objet.image.url }}" class="objet-perdu-img" alt="{{ objet.nom }}">
                    {% else %}
                        <img src="{% static 'images/default-object.png' %}" class="objet-perdu-img" alt="Objet">
                    {% endif %}

                    <div class="objet-perdu-body">
                        <h5>{{ objet.nom|default:"Objet inconnu" }}</h5>
                        <p>{{ objet.description|default:"Aucune description" }}</p>

                        <div class="objet-meta mb-2">
                            <span><i class="fa-regular fa-calendar"></i> {{ declaration.date_declaration|date:"d/m/Y H:i" }}</span>
                            <span class="badge-etat badge-perdu">Perdu</span>
                        </div>

                        <!-- Boutons Modifier / Supprimer -->
                        <div class="text-end">
                            <a href="{% url 'modifier_declaration' objet.id %}" class="btn-action btn-action-edit">
                                ‚úèÔ∏è Modifier
                            </a>
                            <a href="{% url 'supprimer_declaration' objet.id %}" class="btn-action btn-action-delete" 
                               onclick="return confirm('Voulez-vous vraiment supprimer cet objet ?');">
                                üóëÔ∏è Supprimer
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endwith %}
        {% endfor %}
    </div>
{% else %}
    <p class="text-muted">Vous n'avez d√©clar√© aucun objet perdu pour le moment.</p>
{% endif %}
{% endblock %}
