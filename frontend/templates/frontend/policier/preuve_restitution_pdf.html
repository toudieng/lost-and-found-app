{% load static %}

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Preuve de restitution - {{ restitution.id }}</title>
    <style>
        /* ===== Global ===== */
        body {
            font-family: 'DejaVu Sans', sans-serif;
            margin: 2cm;
            color: #333;
            line-height: 1.3;
            font-size: 0.88rem;
        }

        h2, h3, h4 { margin: 0.1rem 0 0.3rem 0; }
        p { margin: 0.1rem 0; }
        strong { color: #C8A048; }

        /* ===== Header ===== */
        .header-table {
            width: 100%;
            border-bottom: 2px solid #003366;
            margin-bottom: 15px;
            border-collapse: collapse;
        }

        .header-table td { vertical-align: middle; }
        .header-table td.left { text-align: left; width: 20%; }
        .header-table td.center { text-align: center; width: 60%; }
        .header-table td.right { text-align: right; width: 20%; }
        .header-table img { height: 50px; width: auto; }

        /* ===== Title ===== */
        .title { text-align: center; color: #003366; margin-bottom: 15px; }
        .title p { font-size: 0.85rem; }

        /* ===== Sections ===== */
        .section { margin-bottom: 15px; page-break-inside: avoid; }
        .section h4 {
            color: #003366;
            border-bottom: 1.5px solid #C8A048;
            display: inline-block;
            padding-bottom: 1px;
            margin-bottom: 3px;
            font-size: 0.95rem;
        }

        .trouveurs, .reclamants { padding-left: 1rem; list-style-type: disc; }

        /* ===== Images ===== */
        .objet-image { 
            margin-top: 5px; 
            max-width: 150px; 
            max-height: 150px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            display: block; 
        }

        /* ===== QR Code ===== */
        .qr { text-align: right; margin-top: 15px; }
        .qr img { height: 70px; }

        /* ===== Signature ===== */
        .signature { margin-top: 20px; text-align: right; font-style: italic; font-size: 0.85rem; }

        /* ===== Footer ===== */
        .footer {
            position: absolute;
            bottom: 1cm;
            text-align: center;
            font-size: 9px;
            color: #888;
            width: 100%;
        }

        /* ===== Highlight ===== */
        .highlight { font-weight: 600; color: #C8A048; }
    </style>
</head>
<body>

    <!-- Header -->
    <table class="header-table">
        <tr>
            <td class="left"><img src="{% static 'frontend/images/logo_senegal.png' %}" alt="Logo Sénégal"></td>
            <td class="center">
                <h2>République du Sénégal</h2>
                <p><strong>Police Nationale</strong> — Preuve de restitution d’objet</p>
            </td>
            <td class="right"><img src="{% static 'frontend/images/logo_police.png' %}" alt="Logo Police"></td>
        </tr>
    </table>

    <!-- Title -->
    <div class="title">
        <h3>Attestation de Restitution N°{{ restitution.id }}</h3>
        <p>Date : {{ restitution.date_restitution|date:"d/m/Y" }} — Heure : {{ restitution.heure_restitution|time:"H:i" }}</p>
    </div>

    <!-- Objet restitué -->
    <div class="section">
        <h4>Objet Restitué</h4>
        <p><strong class="highlight">{{ restitution.objet.nom|default:"Non renseigné" }}</strong></p>
        <p>{{ restitution.objet.description|default:"Aucune description disponible" }}</p>
        {% if restitution.objet.image %}
            <img src="{{ restitution.objet.image.url }}" alt="Image de {{ restitution.objet.nom }}" class="objet-image">
        {% endif %}
        <p>Code unique : <strong>{{ restitution.objet.code_unique }}</strong></p>
    </div>

    <!-- Réclamant principal -->
    <div class="section">
        <h4>TROUVEUR PRINCIPAL</h4>
        {% if reclamant_principal %}
            <p>Nom : <strong>{{ reclamant_principal.username }}</strong></p>
            <p>Email : {{ reclamant_principal.email|default:"Non renseigné" }}</p>
            <p>Téléphone : {{ reclamant_principal.telephone|default:"Non renseigné" }}</p>
        {% else %}
            <p>Nom : <strong>Non renseigné</strong></p>
            <p>Email : Non renseigné</p>
            <p>Téléphone : Non renseigné</p>
        {% endif %}
    </div>

    <!-- Citoyen destinataire -->
    <div class="section">
        <h4>RECLAMANT</h4>
        <p>Nom : <strong>{{ restitution.citoyen.username|default:"Non renseigné" }}</strong></p>
        <p>Email : {{ restitution.citoyen.email|default:"Non renseigné" }}</p>
    </div>

    <!-- Policier -->
    <div class="section">
        <h4>Policier</h4>
        {% if restitution.restitue_par %}
            <p>Nom : <strong>{{ restitution.restitue_par.username }}</strong></p>
            <p>Email : {{ restitution.restitue_par.email|default:"Non renseigné" }}</p>
        {% elif restitution.policier %}
            <p>Nom : <strong>{{ restitution.policier.username }}</strong></p>
            <p>Email : {{ restitution.policier.email|default:"Non renseigné" }}</p>
        {% else %}
            <p>Nom : <strong>Non renseigné</strong></p>
            <p>Email : Non renseigné</p>
        {% endif %}
    </div>

    <!-- Commissariat -->
    <div class="section">
        <h4>Commissariat</h4>
        {% if restitution.commissariat %}
            <p>{{ restitution.commissariat.nom|default:"Non renseigné" }}</p>
            <p>{{ restitution.commissariat.adresse|default:"Adresse non renseignée" }}</p>
        {% else %}
            <p>Commissariat non renseigné</p>
            <p>Adresse non renseignée</p>
        {% endif %}
    </div>

    <!-- QR Code -->
    {% if qr_code %}
    <div class="qr">
        <p><strong>QR Code de vérification :</strong></p>
        <img src="data:image/png;base64,{{ qr_code|safe }}" alt="QR Code">
    </div>
    {% endif %}

    <!-- Signature -->
    <div class="signature">
        <p>Signé par :
            {% if restitution.restitue_par %}{{ restitution.restitue_par.username }}
            {% elif restitution.policier %}{{ restitution.policier.username }}
            {% else %}Non renseigné
            {% endif %}
        </p>
        <p>Fait à {{ restitution.commissariat.nom|default:"Lieu non précisé" }}, le {{ restitution.date_restitution|date:"d/m/Y" }}</p>
    </div>

    <!-- Footer -->
    <div class="footer">
        Document généré automatiquement par le système de gestion des objets perdus et retrouvés © {{ now|date:"Y" }}
    </div>

</body>
</html>
